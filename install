#!/bin/bash

if [ "$1" == '-f' ]; then
  force="--override=*"
else
  force=""
fi

has_stow() {
  if [ ! -f "$(which stow)" ]; then
    echo 'Please install stow.'
    echo '  See http://www.gnu.org/software/stow/'
    echo ''
    echo '  To install:'
    case "$(uname)" in
      "Darwin")
        echo '  brew install stow'
        ;;
      "Linux")
        echo ' apt-get install stow'
        ;;
    esac
    exit 1
  fi
  return 0
}

has_oh_my_zsh() {
  OH_MY_ZSH_DIR=$HOME/.oh-my-zsh
  [ ! -d $OH_MY_ZSH_DIR ] && git clone git://github.com/robbyrussell/oh-my-zsh.git $OH_MY_ZSH_DIR
}

install() {
  has_stow && has_oh_my_zsh

  stow_failed=false
  for package in bash git ruby vim shell zsh
  do
    echo "Stowing $package"
    stow --verbose --target="$HOME" $force $package
    [ $? -ne 0 ] && echo "Unable to stow $package" && stow_failed=true
  done
  $stow_failed && echo "Unable to stow all files. Try ./install -f"


  # Setup Vim
  [ ! -d $HOME/.vim/bundle/vundle ] && git clone https://github.com/gmarik/vundle.git $HOME/.vim/bundle/vundle
  vim +BundleInstall +qall

  echo 'Installation complete'
}


install
